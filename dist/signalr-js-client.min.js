var signalR=new function(){var a=this,l=null;this.url=null;this.transport="webSockets";this.timeout=3E3;var n={},d=null,g=null,e=null,f=null,t=null,m=function(){clearTimeout(t);t=setTimeout(w,3E5)};this.connection=function(b){b&&(l=b,g=encodeURIComponent('[{"name":"'+l+'"}]'));return a};this.start=function(b){e&&e.close();f&&f.close();if(d){var k=encodeURIComponent("[]");h({url:a.url+"/abort?transport="+a.transport+"&clientProtocol=1.5&token=&connectionToken="+d+"&connectionData="+k,method:"POST"})}for(var c in b)b.hasOwnProperty(c)&&
(a[c]=b[c]);x()};this.on=function(b,a){n[b]=a};this.invoke=function(b,k){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];m();c={H:l,M:b,A:c,I:0};switch(a.transport){case "webSockets":e.send(JSON.stringify(c));break;case "serverSentEvents":c="data="+JSON.stringify(c);u(c);break;case "longPolling":c="data="+JSON.stringify(c),u(c)}};var p=function(b){try{m();var k=JSON.parse(b);if(k.M&&k.M[0]){var c=k.M[0];n[c.M]&&n[c.M].apply(a,c.A)}}catch(y){console.log(y)}},h=function(b){var a=new XMLHttpRequest,
c=null;a.open(b.method?b.method:"GET",b.url,!0);b.data&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");a.onreadystatechange=function(a){4===this.readyState&&200===this.status&&(c=JSON.parse(a.currentTarget.responseText),"function"===typeof b.callback&&b.callback(c))};b.timeout&&(a.timeout=b.timeout,a.ontimeout=b.onTimeout?b.onTimeout:null);a.send(b.data?b.data:null)},x=function(){a.url&&l?h({url:a.url+"/negotiate?clientProtocol=1.5&connectionData=%5B%7B%22name%22%3A%22"+
l+"%22%7D%5D",callback:function(b){d=encodeURIComponent(b.ConnectionToken);a.transport=b.TryWebSockets||"webSockets"!==a.transport?a.transport:"serverSentEvents";q()},timeout:a.timeout,onTimeout:function(){console.log("Cannot connect to SignalR server.")}}):console.log("Error in initializing SignalR: Please set url and hub name!")},q=function(){switch(a.transport){case "webSockets":var b="ws://"+a.url.replace(/https?:\/\//i,"");e=new WebSocket(b+"/connect?transport=webSockets&clientProtocol=1.5&connectionToken="+
d+"&connectionData="+g);e.onerror=function(b){e.close();e=null;a.transport="serverSentEvents";q()};e.onopen=function(a){r()};e.onmessage=function(a){p(a.data)};break;case "serverSentEvents":f=new EventSource(a.url+"/connect?transport=serverSentEvents&clientProtocol=1.5&connectionToken="+d+"&connectionData="+g);setTimeout(function(){f.readyState!==EventSource.OPEN&&(f.close(),f=null,a.transport="longPolling",q())},3E3);f.onopen=function(a){r()};f.onmessage=function(a){p(a.data)};f.onerror=function(b){b.readyState===
EventSource.CLOSED&&(a.transport="longPolling",console.log("Long polling activated."))};break;case "longPolling":h({url:a.url+"/connect?transport=longPolling&clientProtocol=1.5&connectionToken="+d+"&connectionData="+g,callback:r})}},r=function(){h({url:a.url+"/start?transport="+a.transport+"&clientProtocol=1.5&connectionToken="+d+"&connectionData="+g,method:"POST",callback:"longPolling"===a.transport?function(){v();m()}:m})},v=function(){h({url:a.url+"/poll?transport="+a.transport+"&clientProtocol=1.5&connectionToken="+
d+"&connectionData="+g,method:"POST",callback:function(a){p(JSON.stringify(a));v()}})},w=function(){h({url:a.url+"/ping?transport="+a.transport+"&clientProtocol=1.5&connectionToken="+d+"&connectionData="+g,method:"POST",callback:m})},u=function(b){h({url:a.url+"/send?transport="+a.transport+"&clientProtocol=1.5&connectionToken="+d+"&connectionData="+g,method:"POST",data:b})}};